@startuml
title Процесс "Управление заявкой"

start

partition "Руководитель / Бригадир" {
  :Открыть форму создания заявки;
  :Ввести данные заявки
  (ФИО заявителя,\nадрес, номер договора,\nописание работ);
}

partition "Система" {
  :Автоматически зафиксировать\nдату обращения;
  :Проверить обязательные поля;
  if (Все обязательные\nполя заполнены?) then (Да)
    :Присвоить заявке\nуникальный номер;
    :Сохранить заявку со статусом "Новая";
  else (Нет)
    :Показать сообщение\nоб ошибке и\nвернуть на ввод данных;
    goto ввод_данных
  endif
}

label ввод_данных
' Метка для возврата
' (визуально не обязательно отображать в отчёте)

partition "Руководитель / Бригадир" {
  :Просмотр списка заявок;
  :Выбрать заявку для работы;
}

partition "Система" {
  :Показать детали\nвыбранной заявки;
}

' Основной цикл изменения статусов
while (Работа с заявкой\nпродолжается?) is (Да)
  partition "Руководитель / Бригадир" {
    if (Изменить данные\nзаявки?) then (Да)
      if (Текущий статус = "Новая"?) then (Да)
        :Редактировать данные заявки;
        :Сохранить изменения;
      else (Нет)
        :Показать сообщение:\n"Редактирование запрещено\nпосле статуса 'В работе'";
      endif
    endif

    if (Изменить статус\nзаявки?) then (Да)
      :Выбрать новый статус
      ("В работе", "На паузе",\n"Завершена", "Отменена");
    endif
  }

  partition "Система" {
    if (Выбранный статус\nкорректен по переходам?) then (Да)
      :Изменить статус заявки;
    else (Нет)
      :Показать сообщение\nо недопустимом переходе\nстатуса;
    endif
  }
endwhile (Нет)

stop
@enduml
